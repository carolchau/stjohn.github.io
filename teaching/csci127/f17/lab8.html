<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Lab 8, CSci 127, Introduction to Computer Science, Hunter College, CUNY, Fall 2017</title>
    <link type="text/css" rel="stylesheet" href="../../../lehman.css" />
</head>
<body>

<div id="header">

<h2>Lab 8<br>CSci 127: Introduction to Computer Science<br>
Hunter College, City University of New York<br>
Fall 2017<br><br>
</h2>
</div>

<div>

<p>
Today's lab will focus on mapping data, using pandas, numpy, and folium, and using Python from the command line.  

<p>Software tools needed:  web browser and Python IDLE programming 
environment with the pandas and matplotlib packages installed.



</div>

<div>
<h3>Using Python, Gradescope, and Blackboard</h3>

<p>See <a href="lab1.html">Lab 1</a> for details on using Python, Gradescope, and Blackboard.
</p>
</div>


<div>
<h3>Binning Data:  Parking Tickets</h3>

<p>A simple, but very powerful, technique is "binning data"-- that is grouping data into the number of occurrences for each categories.  The category values can often show patterns that individual data points do not.  For example, binning population by zipcode can show patterns in density that's difficult to see with individual data points.  

<p>
Today, we will look at the parking tickets issues by New York City in fiscal year 2016. 
<div>
<h3> Parking Tickets in Your Neighborhood</h3>

<p>
Via the <a href="https://data.cityofnewyork.us">NYC Open Data</a> project, you can access data from almost every city agency.   We will use the parking ticket data set.  Since it is quite large, even for a single year, we will focus on your neighborhood.  
<ul>
	<li> Instead of neighborhood name or zipcode, parking tickets are classified by the police precinct that issued the ticket.  First, figure out the precinct (here's a <a href="http://www.nyc.gov/html/nypd/html/precinct_maps/precinct_finder.shtml">useful tool</a>)
	<li>  
	<a href= "https://data.cityofnewyork.us/City-Government/Parking-Violations-Issued-Fiscal-Year-2016/kiv2-tbus/data">Fiscal year 2016 (FY2016) parking tickets</a> for your precinct:  download the data set as a CSV, filtering by precinct. For example, Macaulay Honors College is located in the 20th Precinct, so, you would enter <tt>20</tt> on the filter.

</ul>
</div>

<div>
<h3>CSV Data Files</h3>

CSV files store tabular information in readable text files.  The files downloaded above have information separated by commas (using tabs as delimiters is also common).  Here is a sample line:
<pre>
1335632335,L040HZ,FL,PAS,06/09/2015,46,SUBN,NISSA,X,35430,14510,15710,0,0020,20,74,921167,E074,0000,1213P,1207P,NY,O,4,WEST 83 ST,,0,408,C,,BBBBBBB,ALL,ALL,RED,0,0,-,0,,,,,
</pre>
<p>
All lines are formatted similarly: they start with the 
summons number, then the license plate, registration state, plate Type, date, and continue with the information about the location and type of violation, and sometimes additional information such as the who issued the ticket and the color of the car. The first line of the file gives the entries in the order they occur in the rows. 

<p>
The sample entry above gives details for a ticket issues on June 9, 2015 to a passenger car with Florida plates, L040HZ.  The red Nissan SUV received the ticket on West 83rd Street.  Each entry also begins with a unique identifier that can be used to look up the parking ticket.
</div>


(see <a href="hw2.html">Homework 2</a> for details).  Since the set is quite large, we will focus on the 20th precinct in which Macaulay Honors College is located.  Since there were over 196,000 tickets for the FY 2016 for the 20th precinct, the file for today's classwork is the first 1000 lines:  <a href="tickets.csv">tickets.csv</a>.

<p>
Here is a sample line of <a href="tickets.csv">tickets.csv</a>:
<pre>
1335632335,L040HZ,FL,PAS,06/09/2015,46,SUBN,NISSA,X,35430,14510,15710,0,0020,20,74,921167,E074,0000,1213P,1207P,NY,O,4,WEST 83 ST,,0,408,C,,BBBBBBB,ALL,ALL,RED,0,0,-,0,,,,,
</pre>
<p>
All lines are formatted similarly: they start with the 
summons number, then the license plate, registration state, plate Type, date, and continue with the information about the location and type of violation, and sometimes additional information such as the who issued the ticket and the color of the car. The first line of the file gives the entries in the order they occur in the rows. 

<p>
Here are some questions we can ask about the data:
<ul>
	<li> which car got the most tickets?
	<li> what color of car is most likely to get a ticket?
	<li> what type of license gets the most tickets?
	<li> which location yields the most tickets?
</ul>
	
For each of these questions, we can traverse the file and count the occurrences as we go.  A great way to do this is with dictionaries.

</div>
<div>
<h3>Counting Tickets per Car</h3>

<p> How can tell which car got the most tickets?  First, we need to figure out a unique way to identify different cars.  Luckily, cars almost always have license plates-- with each state having a unique number.  (For this simple exercise, we'll assume that each license plate is unique on its own-- not an unreasonable assumption since every state has a different schema for assigning numbers, but to be more accurate we should keep track of license plate number and issuing state.)

<p>Open up the CSV file and look at the columns.  Which column contains the license plate number?  For each line, we can pull out the licence plate number and use it as a "key" for a dictionary.  Here's the basic idea of our program to count tickets per car:

<ol>
	<li> Open CSV file.
	<li> Initialize the dictionary, <tt>tickets</tt>.
	<li> Read first line of column names.
	<li> For each line in the file:
	<li> &nbsp; &nbsp; &nbsp; &nbsp; Let <tt>plate</tt> be the license plate on the line. </tt>
	<li> &nbsp; &nbsp; &nbsp; &nbsp; Update the count of tickets for <tt>plate</tt>.
	<li> Sort the dictionary by value.
	<li> Print out the top 10 license plates, in terms of ticket counts.
</ol>

<p>
Use df['status'].value_counts()


<p>
Lets use the <tt>csv</tt> module, as we did at the end of last weeks' classwork (if you didn't reach that part of the classwork, read <a href="plotRecipes.html">that last section</a> before continuing).  
We will add in the Python code for each of these steps:
<ul>
	<li> We are using the csv library, so need to import it:
	<pre>
import csv	
	</pre>

	<li> We will use a dictionary to store the ticket information:	
<pre>
#Setting up a dictionary to store tickets:
tickets = {}
</pre>

	<li> Our data is in <tt>tickets.csv</tt> which we can open with a dictionary reader:
<pre>
#Using the dictionary reader to access by column names
f = open("tickets.csv")
reader = csv.DictReader(f)
</pre>

	<li> Since we are using a dictionary reader, we can refer to columns from the CSV files by name:
<pre>
for row in reader:
    plate = row["Plate ID"]
    tickets[plate] = tickets.get(plate, 0) + 1
    print("Ticket", tickets[plate], "for", plate)
f.close()
</pre>
	(The <tt>print()</tt> is there so we can check that it's working.)
	
	<li> We want the license plates that got the highest number of tickets.  There are several ways to do this (see dictionary examples on class webpage for a nice way to do this with list comprehensions.  Here, we first make a list of the worst offenders (sorting in reverse since we want the largest values first):
<pre>
worst = sorted(tickets, key = tickets.__getitem__, reverse=True)
</pre>
	Once we have that list, we can just print out the top 10 values:
<pre>
for i in range(10):
    print("Plate", worst[i], "has", tickets[worst[i]], "tickets.")
</pre>
</ul>

Try your program to make sure it works, and then move on to the challenges below.
</div>

<div>

<h3>Binning Other Data</h3>

<p>Now that you have a program to use as a basic template, answer the following questions:
<ul>
	<li> what color of car is most likely to get a ticket?
	<li> what type of license gets the most tickets?
	<li> which location yields the most tickets?
</ul>	
(Remember to check the csv file for the name used for the columns and use that with your dictionary reader.)

</div>
			
<div>
<h3>Additional Challenges</h3>

Modify your Python programs to answer the following:
<ul>
	<li> Which street was the location of the most tickets?
	<li> What were the most common violations?
	<li> Bin the ticket data by the hour the violation occurred and display as a histogram.
	<br>(Hint:  The violation time is stored as a 5 character string such as "0932A" and "0810P"-- convert into 24 hour time to keep from conflating morning and afternoon tickets).
</ul>
</div>
			


<div>
<h3>Top Down Design</h3>

<p>
Functions are used to design programs and provide an elegant 
way to divide work among several programmers.  A standard technique,
called <b>top-down design</b>, consists of breaking a program into multiple
function calls (covered in more detail in Chapter 8).  
Each function is written separately and then tested, before
the next function is written.  

<p>
<img src="herd.png" height=300>

<p>In today's lab, we will write a program to draw images using turtles.  We will focus on breaking down the problem into functions, and then implementing (and testing!) each function separately.  Here's a basic outline of our program:

<pre>
#Intro Programming Lab:  A program with a herd of turtles

import turtle

def main():
    welcomeMessage()            #Writes a welcome message to the shell
    numTurtles = getInput()     #Ask for number of turles
    w = setUpScreen()           #Set up a green turtle window
    turtleList = setUpTurtles(numTurtles) #Make a list of turtles, different colors
    for i in range(10):
        moveForward(turtleList) #Move each turtle in the list forward
        stamp(turtleList)       #Stamp where the turtle stopped
    

if __name__ == "__main__":
    main()
</pre>
We will fill in each function, one-by-one, using the comments as guidance.
The first function should welcome the user to the program:
<pre>
def welcomeMessage():
    print()
    print("Welcome to our herd of turtles demonstration!")
    print()
</pre>
Add it to the program above and run it to make sure there are no typos or
errors.  

<p>Next, let's ask the user for the number of turtles.  Since the function call 
is on the right hand side of an equals sign, it returns a value (namely, the number
of turtles) that we will use later in the program.  So, our function will ask
the user for the number and then use a <tt>return</tt> statement to send that
value back to the calling function:
<pre>
def getInput():
    n = eval(input("Please enter the number of turtles: "))
    return n
</pre>
When we add these in, we now have the program:
<pre>
#Intro Programming Lab:  A program with herd of turtles

import turtle


def welcomeMessage():
    print()
    print("Welcome to our herd of turtles demonstration!")
    print()

def getInput():
    n = eval(input("Please enter the number of turtles: "))
    return n

def main():
    welcomeMessage()            #Writes a welcome message to the shell
    numTurtles = getInput()     #Ask for number of turles
    w = setUpScreen()           #Set up a green turtle window
    turtleList = setUpTurtles(numTurtles) #Make a list of turtles, different colors
    for i in range(10):
        moveForward(turtleList) #Move each turtle in the list forward
        stamp(turtleList)       #Stamp where the turtle stopped
    

if __name__ == "__main__":
    main()
</pre>

We still need to set up the turtle window and make it green.  The
turtle command to change the background color is <tt>bgcolor</tt> and
colors can be referred by their names or the percentage of red, green,
and blue ('RGB') in the color.  Let's use the name to change the window
color:
<pre>
def setUpScreen():
    w = turtle.Screen()
    w.bgcolor("green")
    return w
</pre>
Next, we need to set up a list of turtles.  From the function invocation in the
<tt>main()</tt> we know it has the outline:
<pre>
def setUpTurtles(n):
    #Create a list of turtles
    #Make each turtle appear turtle-shaped
    #Change the color and default direction (so they don't run over each other)
    return tList
</pre>
To set up our list, we will follow our outline from the strings and lists chapter:
<ol>
	<li> Create an empty list
	<li> Make a new item

</ol>
For our turtles, this looks like:
<pre>
def setUpTurtles(n):
    tList = []
    #Create turtles:
    for i in range(n):
        t = turtle.Turtle()
        t.shape("turtle")       #Make the turtle appear turtle-shaped
        tList.append(t)
        
    return tList
</pre>
Lastly for this function, we need to change the color and direction.  We will use the `red-blue-green' (`RGB') values to give each turtle a different color.  To keep the turtle color from clashing with the green background, we will set the red and green parts of the color to 0, and just allow the blue to change from 50% to 100%.  To spread the turtles out, we'll divide the circle into even angles:
<pre>
def setUpTurtles(n):
    tList = []
    #Create turtles:
    for i in range(n):
        t = turtle.Turtle()
        t.shape("turtle")       #Make the turtle appear turtle-shaped
        tList.append(t)
        
    #Change their color from the blue default and default direction
    for i in range(n):
        tList[i].color(0,0,i/(2*n)+.5)
        tList[i].right(i*360/n)
     
    return tList
</pre>
If you run your program, you will see the turtles arranged pointing outwards from 
a center point, in different shapes of blue.

<p>The next functions of the program are straightforward.  We will move each turtle forward using a for-loop.  We chose 30 by experimenting with window size.  If it does not fit well on your screen, change the forward distance to something that does.  To make a stamp of where the turtle has been, we use the Turtle graphics function, <tt>stamp()</tt>
<pre>
def moveForward(tList):
    for t in tList:
        t.forward(30)

def stamp(tList):
    for t in tList:
        t.stamp()
</pre>

Putting all the pieces together, we get:
<pre>
#Intro Programming Lab:  A program with herd of turtles

import turtle


def welcomeMessage():
    print()
    print("Welcome to our herd of turtles demonstration!")
    print()

def getInput():
    n = eval(input("Please enter the number of turtles: "))
    return n

          
def setUpScreen():
    w = turtle.Screen()
    w.bgcolor("green")
    return w

def setUpTurtles(n):
    tList = []
    #Create turtles:
    for i in range(n):
        t = turtle.Turtle()
        t.shape("turtle")       #Make the turtle appear turtle-shaped
        tList.append(t)
        
    #Change their color from the blue default and default direction
    for i in range(n):
        tList[i].color(0,0,i/(2*n)+.5)
        tList[i].right(i*360/n)
     
    return tList

def moveForward(tList):
    for t in tList:
        t.forward(30)

def stamp(tList):
    for t in tList:
        t.stamp()

def main():
    welcomeMessage()            #Writes a welcome message to the shell
    numTurtles = getInput()     #Ask for number of turles
    w = setUpScreen()           #Set up a green turtle window
    turtleList = setUpTurtles(numTurtles) #Make a list of turtles, different colors
    for i in range(10):
        moveForward(turtleList) #Move each turtle in the list forward
        stamp(turtleList)       #Stamp where the turtle stopped
    

if __name__ == "__main__":
    main()
</pre>
Try running your program.  What happens?  How could you modify it to make green 
turtles on a blue background?  What would you need to modify to make the turtles
make a circle each time?


</div>







<!--
<div>
<h3>Plotting from Input</h3>

<p>Let's write a program that plots 5 locations that the user enters. 

<p> Write with a function?

<p> See <a href="ps.html">Programming Problem List</a>.

</div>
-->




<div>
<h3>github</h3>

<a href="https://github.com">github</a> is the standard way to share and collaborate on code.  It functions much as Google docs does for documents.
We will use it as a place (<b>repository</b> or "repo") for programs and lab exercises.

<ol>
	<li> If you do not already have an account, create an account on <a href="https://github.com">github</a>.  <tt>github</tt> will be used in future classes (and by employers), so, choose an account name that you can use for years to come.
	<li> Work through the <a href="http://readwrite.com/2013/09/30/understanding-github-a-journey-for-beginners-part-1">github for beginners</a> tutorial.
	<li> Work through the 
		<a href="https://guides.github.com/activities/hello-world/">github Hello World</a> tutorial.
</ol>

</div>

<div>
<h3>In-class Quiz</h3>

During lab, there is a <a href="quizzes.html">quiz</a>.  The password to access the quiz will be given during lab.  To complete the quiz, log on to Blackboard (see <a href="lab1.html">Lab 1</a> for details on using Blackboard).

</div>



<div>

<h3>What's Next?</h3>

<p>If you finish the lab early, now is a great time to get a head start on the programming problems due early next week.  There's instructors to help you, and you already have Python up and running.  The <a href="ps.html">Programming Problem List</a> has problem descriptions, suggested reading, and due dates next to each problem.

</div>



</html>